{% extends "base.html"%}

{% block content %}


{% verbatim %}
<div id="app">
    <p>Get players to join with: <a href="/game/{{ gameId }}/join">this link</a></p>

    <button id="start">Start the game</button>

    <p>Clicking this will prevent other players from joining.</p>
    {{ status }}

    <ul>
        <li v-for="player in players">
            {{ player }}
        </li>
    </ul>
</div>
{% endverbatim %}

{% endblock %}
{% block script %}
<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
<script>
const gameId = "{{ game_id }}";
const playerId = "{{ player_id }}";

const app = new Vue({
  el: '#app',
  data: {
    gameId,
    status: 'GATH',
    players: [],
    components: []
  }
})

const chatSocket = new WebSocket(
    (window.location.protocol === 'https:' ? 'wss://' : 'ws://')
    + window.location.host
    + '/ws/game/'
    + gameId
    + '/player/'
    + playerId
);

chatSocket.onmessage = function(e) {
    const data = JSON.parse(e.data);
    Object.keys(data).forEach(k => {
        app[k] = data[k];
    })
};

chatSocket.onclose = function(e) {
    console.error('Chat socket closed unexpectedly');
};

chatSocket.onopen = function(e) {
    chatSocket.send('{"_type": "request_refresh"}')
}

</script>
{% endblock%}
